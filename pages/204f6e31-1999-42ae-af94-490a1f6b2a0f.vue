<template>
    <div class="ui container">

        <h1>–ö–æ–Ω—Ç–∞–∫—Ç—ã, –∑–∞–ø–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</h1>


        <p>–Ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤ –¥–≤—É—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö:</p>
        <p><b>üîπ–û—á–Ω—ã–π –ø—Ä–∏—ë–º<br></b>–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É—é –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–º —Ü–µ–Ω—Ç—Ä–µ –≤ –ú–æ—Å–∫–≤–µ (—Ä–∞–π–æ–Ω –ú–∏—Ç–∏–Ω–æ).
                –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–æ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π –∏
                –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.</p>
        <p>üîπ<b>–û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏<br></b>–î–æ—Å—Ç—É–ø–Ω—ã –∏–∑ –ª—é–±–æ–π —Ç–æ—á–∫–∏ –º–∏—Ä–∞ —á–µ—Ä–µ–∑ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –≤–∏–¥–µ–æ—Å–≤—è–∑–∏.
                –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –æ–Ω–ª–∞–π–Ω –ø–æ –≤–∏–¥–µ–æ—Å–≤—è–∑–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç
                –ø–æ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞–º:</p>
        <p>‚Ä¢ WhatsApp<br>‚Ä¢ Telegram</p>
        <p>
            <b>–ü–æ–∑–≤–æ–Ω–∏—Ç—å</b>: <a href="tel:+79263750528" class="not-prose">+7 (926) 375-05-28</a>
        </p>
        <p>
            <b>–ù–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp</b>: <a href="https://wa.me/79263750528?text=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é!" class="not-prose" target="_blank">+7 (926) 375-05-28</a>
        </p>
        <p><b>–ù–∞–ø–∏—Å–∞—Ç—å –≤ –¢–µ–ª–µ–≥—Ä–∞–º–º</b>: <a href="https://t.me/gomeopat_tarasova" target="_blank" class="not-prose">@gomeopat_tarasova</a>
        </p>
  
        <p>–ó–∞–ø–∏—Å—å
            –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –≤–µ–¥—É —è —Å–∞–º–∞.</p>
        <p><b>–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</b> –í—ã –º–æ–∂–µ—Ç–µ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É, WhatsApp, –¢–µ–ª–µ–≥—Ä–∞–º–º –∏–ª–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É</p>


    <el-form :model="form" label-width="auto" ref="formRef" class="max-w-96 my-12" label-position="top">
      <el-form-item label="–í–∞—à–µ –∏–º—è" prop="name" :rules="[
        {
          required: true,
          message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –∏–º—è',
          trigger: 'blur',
        },
      ]">
        <el-input v-model="form.name" />
      </el-form-item>
      <el-form-item label="–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω" prop="phone">
        <el-input v-model="form.phone" />
      </el-form-item>
      <el-form-item label="–í–∞—à –µ–º–µ–π–ª" prop="email" :rules="[
        {
          required: true,
          message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã',
          trigger: 'blur',
        },
        {
          type: 'email',
          message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã',
          trigger: ['blur', 'change'],
        },
      ]">
        <el-input v-model="form.email" />
      </el-form-item>
      <el-form-item label="–°–æ–æ–±—â–µ–Ω–∏–µ" prop="desc" :rules="[
        {
          required: true,
          message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ',
          trigger: 'blur',
        },
      ]">
        <el-input v-model="form.desc" type="textarea" />
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="throttledFn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</el-button>
        <el-button @click="resetForm(formRef)">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</el-button>
      </el-form-item>
    </el-form>

        <el-button class="not-prose" tag="router-link" :to="the.parent.to" :icon="Back" type="success">–Ω–∞
            –≥–ª–∞–≤–Ω—É—é</el-button>


    </div>
</template>



<script setup>

import { Back } from '@element-plus/icons-vue';
import { useThrottleFn } from "@vueuse/core";
import { reactive, ref, inject } from "vue";
import { ElMessage } from "element-plus";

const { id } = defineProps(["id"]),
  the = inject("pages")[id],
  formRef = ref(),
  method = "POST",
  headers = {
    "Content-Type": "application/json",
  },
  form = reactive({
    name: "",
    phone: "",
    email: "",
    desc: "",
  }),

  throttledFn = useThrottleFn(sendForm, 6000);

function resetForm(formEl) {
  formEl?.resetFields();
}

function sendForm() {
  formRef.value?.validate(async (valid) => {
    if (valid) {
      const body = JSON.stringify(form);
      try {
        ElMessage("–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...");
        const response = await fetch("https://form.homeopatiya.ru", {
          method,
          headers,
          body,
        });
        ElMessage.closeAll();
        if (response.ok) {
          ElMessage.success(await response.text());
          formRef.value?.resetFields();
        } else ElMessage.error(`–û—à–∏–±–∫–∞: ${await response.text()}`);
      } catch ({ message }) {
        ElMessage.closeAll();
        ElMessage.error(`–û—à–∏–±–∫–∞: ${message}`);
      }
    } else ElMessage.error("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É");
  });
}

</script>
